(function(f){var k=function(){var c=function(){};c.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,e,d){if(!d)this.context=b,this.buffer=[];if(!this.includes("",a))if(d)return a;else{this.send(a);return}a=this.render_pragmas(a);a=this.render_section(a,b,e);if(d)return this.render_tags(a,b,e,d);this.render_tags(a,b,e,d)},send:function(a){a!=""&&this.buffer.push(a)},render_pragmas:function(a){if(!this.includes("%",a))return a;
var b=this;return a.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(a,d,h){if(!b.pragmas_implemented[d])throw{message:"This implementation of mustache doesn't understand the '"+d+"' pragma"};b.pragmas[d]={};h&&(a=h.split("="),b.pragmas[d][a[0]]=a[1]);return""})},render_partial:function(a,b,e){a=this.trim(a);if(!e||e[a]===void 0)throw{message:"unknown_partial '"+a+"'"};if(typeof b[a]!="object")return this.render(e[a],b,e,!0);return this.render(e[a],b[a],e,!0)},render_section:function(a,
b,e){if(!this.includes("#",a)&&!this.includes("^",a))return a;var d=this;return a.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(a,c,f,g){a=d.find(f,b);if(c=="^")return!a||d.is_array(a)&&a.length===0?d.render(g,b,e,!0):"";else if(c=="#")return d.is_array(a)?d.map(a,function(a){return d.render(g,d.create_context(a),e,!0)}).join(""):d.is_object(a)?d.render(g,d.create_context(a),e,!0):typeof a==="function"?a.call(b,
g,function(a){return d.render(a,b,e,!0)}):a?d.render(g,b,e,!0):""})},render_tags:function(a,b,e,d){for(var c=this,f=function(){return RegExp(c.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+c.ctag+"+","g")},j=f(),g=function(a,d,g){switch(d){case "!":return"";case "=":return c.set_delimiters(g),j=f(),"";case ">":return c.render_partial(g,b,e);case "{":return c.find(g,b);default:return c.escape(c.find(g,b))}},a=a.split("\n"),i=0;i<a.length;i++)a[i]=a[i].replace(j,g,this),d||this.send(a[i]);if(d)return a.join("\n")},
set_delimiters:function(a){a=a.split(" ");this.otag=this.escape_regex(a[0]);this.ctag=this.escape_regex(a[1])},escape_regex:function(a){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){var a=this.trim(a),e;b[a]===!1||b[a]===0||b[a]?e=b[a]:(this.context[a]===!1||this.context[a]===0||this.context[a])&&(e=this.context[a]);if(typeof e==="function")return e.apply(b);if(e!==
void 0)return e;return""},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){return String(a===null?"":a).replace(/&(?!\w+;)|["<>\\]/g,function(a){switch(a){case "&":return"&amp;";case "\\":return"\\\\";case '"':return'"';case "<":return"&lt;";case ">":return"&gt;";default:return a}})},create_context:function(a){if(this.is_object(a))return a;else{var b=".";if(this.pragmas["IMPLICIT-ITERATOR"])b=this.pragmas["IMPLICIT-ITERATOR"].iterator;var e={};e[b]=a;return e}},is_object:function(a){return a&&
typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function")return a.map(b);else{for(var e=[],d=a.length,c=0;c<d;c++)e.push(b(a[c]));return e}}};return{name:"mustache.js",version:"0.3.0",to_html:function(a,b,e,d){var f=new c;if(d)f.send=d;f.render(a,b,e);if(!d)return f.buffer.join("\n")}}}();window.ich=new function(){var c=this;c.VERSION="0.9";c.templates={};
c.partials={};c.addTemplate=function(a,b){if(c[a])throw"Invalid name: "+a+".";if(c.templates[a])throw'Template " + name + " exists';c.templates[a]=b;c[a]=function(b,d){var b=b||{},h=k.to_html(c.templates[a],b,c.partials);return d?h:f(h)}};c.addPartial=function(a,b){if(c.partials[a])throw'Partial " + name + " exists';else c.partials[a]=b};c.grabTemplates=function(){f('script[type="text/html"]').add("div.template").each(function(a,b){var e=f(typeof a==="number"?b:a),d="".trim?e.html().trim():f.trim(e.html()),
d=d.replace(/&gt;/,">");c[e.hasClass("partial")?"addPartial":"addTemplate"](e.attr("id"),d);e.remove()})};c.clearAll=function(){for(var a in c.templates)delete c[a];c.templates={};c.partials={}};c.refresh=function(){c.clearAll();c.grabTemplates()}};f(function(){ich.grabTemplates()})})(window.jQuery||window.Zepto);
